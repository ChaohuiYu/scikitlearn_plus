"""
Extended math utilities.
"""
# Authors: Gael Varoquaux
#          Alexandre Gramfort
#          Alexandre T. Passos
#          Olivier Grisel
#          Lars Buitinck
#          Stefan van der Walt
#          Kyle Kastner
#          Giorgio Patrini
# License: BSD 3 clause

import numpy as np
#from scipy.sparse import issparse, csr_matrix
from pycuda import gpuarray
import pycuda.autoinit
import skcuda.linalg as culinalg
culinalg.init()

def safe_sparse_dot(a, b, transa='N', transb='N', dense_output=True):
    '''
    Parameters
    ----------
    a : array
    b : array

    Returns
    -------
    dot_product : array
    '''
    return culinalg.dot(a, b, transa, transb)

    
    """Dot product that handle the sparse matrix case correctly

    Uses BLAS GEMM as replacement for numpy.dot where possible
    to avoid unnecessary copies.

    Parameters
    ----------
    a : array or sparse matrix
    b : array or sparse matrix
    dense_output : boolean, default False
        When False, either ``a`` or ``b`` being sparse will yield sparse
        output. When True, output will always be an array.

    Returns
    -------
    dot_product : array or sparse matrix
        sparse if ``a`` or ``b`` is sparse and ``dense_output``=False.
    
    if issparse(a) or issparse(b):
        ret = a * b
        if dense_output and hasattr(ret, "toarray"):
            ret = ret.toarray()
        return ret
    else:
        return np.dot(a, b)
    """